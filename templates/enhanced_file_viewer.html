<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â¢ûÂº∑Ê™îÊ°àÊ™¢Ë¶ñÂô® - {{ file_name }}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Animate.css -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <!-- Ëá™ÂÆöÁæ© CSS -->
    <link href="/static/css/file_viewer.css" rel="stylesheet">
	<link href="/static/css/file_viewer_marks.css" rel="stylesheet">
	<link href="/static/css/file_viewer_enhanced.css" rel="stylesheet">
	<link href="/static/css/file_viewer_final.css" rel="stylesheet">
	<link href="/static/css/file_viewer_navigation_fix.css" rel="stylesheet">
	<link href="/static/css/file_viewer_export_fix.css" rel="stylesheet">
	<link href="/static/css/file_viewer_export_full_page.css" rel="stylesheet">
	<link href="/static/css/file_viewer_goto_line.css" rel="stylesheet">
    <link href="/static/css/file_viewer_comments.css" rel="stylesheet">
</head>
<body>
    <!-- Ë®≠ÂÇôÂàáÊèõÂô® -->
	<div class="device-switcher" style="z-index: 10000;">
		<button class="device-btn" data-device="desktop" title="ÈõªËÖ¶Áâà">
			<i class="fas fa-desktop"></i>
		</button>
		<button class="device-btn" data-device="mobile" title="ÊâãÊ©üÁâà">
			<i class="fas fa-mobile-alt"></i>
		</button>
	</div>
    
    <!-- Ë©ïË´ñÁÆ°ÁêÜÊåâÈàï -->
    <div class="comment-manager-fab" onclick="toggleCommentsView()">
        <i class="fas fa-comments"></i>
        <span class="comment-count-badge">0</span>
    </div>

    <!-- Âø´ÈÄüË∑≥ËΩâÂà∞Ë©ïË´ñÂçÄ
    <a href="#comments-section" class="quick-comment-link" id="quick-comment-link">
        <i class="fas fa-comments"></i>
        <span>Êü•ÁúãË©ïË´ñ</span>
        <span class="comments-count-quick">0</span>
    </a> -->

    <!-- Èö±ËóèÁöÑÂàùÂßãË≥áÊñô -->
    <input type="hidden" id="initial-start-line" value="{{ result.start_line }}">
    <input type="hidden" id="initial-end-line" value="{{ result.end_line }}">
    <input type="hidden" id="initial-total-lines" value="{{ result.total_lines }}">
    <input type="hidden" id="initial-file-path" value="{{ file_path }}">
    <input type="hidden" id="initial-target-line" value="{{ result.target_line }}">
    
    <!-- Ê™îÊ°àÊ®ôÈ°åÂçÄÂüü -->
    <div class="file-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h4 class="mb-2 animate__animated animate__fadeInLeft">
                        <i class="fas fa-file-code me-2"></i>{{ file_name }}
                    </h4>
                    <div class="file-info-badge animate__animated animate__fadeInLeft animate__delay-1s">
                        <div class="info-item">
                            <i class="fas fa-folder-open"></i>
                            <span>{{ file_path }}</span>
                        </div>
                        <div class="divider"></div>
                        <div class="info-item">
                            <i class="fas fa-list-ol"></i>
                            <span>{{ result.total_lines }} Ë°å</span>
                        </div>
                        <div class="divider"></div>
                        <div class="info-item">
                            <i class="fas fa-eye"></i>
                            <span>È°ØÁ§∫: {{ result.start_line }}-{{ result.end_line }}</span>
                        </div>
                        <div class="divider"></div>
                        <div class="info-item">
                            <i class="fas fa-crosshairs"></i>
                            <span>ÁõÆÊ®ô: Á¨¨ {{ result.target_line }} Ë°å</span>
                        </div>
                    </div>
                    
                    <!-- È´ò‰∫ÆÈ°èËâ≤Âø´ÈÄüË∑≥ËΩâÂçÄ -->
                    <div class="highlight-jumper">
                        <span class="highlight-label">Âø´ÈÄüË∑≥ËΩâ:</span>
                    </div>
                </div>
                <div class="col-lg-4 text-end">
                    <div class="animate__animated animate__fadeInRight btn-group-aligned">
                        <a href="/multi_viewer" class="btn btn-outline-primary" style="margin-right: 10px;">
                            <i class="fas fa-folder-tree"></i>
                            <span>Â§öÊ™îÊ°àÊ®°Âºè</span>
                        </a>                        
                        <div class="export-group d-inline-block position-relative">
                            <button class="btn btn-export">
                                <i class="fas fa-cloud-download-alt"></i>
                                <span>ÂåØÂá∫Ê™îÊ°à</span>
                                <i class="fas fa-caret-down ms-2"></i>
                            </button>
							<div class="export-dropdown" style="display: none;">
								<div class="export-option" onclick="exportFile('all')">
									<i class="fas fa-cloud-download-alt"></i>
									<div class="export-option-content">
										<div class="export-option-title">ÂåØÂá∫ÂÆåÊï¥Ê™îÊ°à</div>
										<div class="export-option-desc">‰∏ãËºâÂéüÂßãÊ™îÊ°àÁöÑÂÆåÊï¥ÂÖßÂÆπ</div>
									</div>
									<span class="export-option-badge">ÂÖ®ÈÉ®</span>
								</div>
								
								<div class="export-dropdown-divider"></div>
								
								<div class="export-option" onclick="exportFile('partial')">
									<i class="fas fa-file-export"></i>
									<div class="export-option-content">
										<div class="export-option-title">
											ÂåØÂá∫Áï∂ÂâçÁØÑÂúç
										</div>
										<div class="export-option-desc">
											Á¨¨ <span id="export-start">{{ result.start_line }}</span> - <span id="export-end">{{ result.end_line }}</span> Ë°å
										</div>
									</div>
									<span class="export-option-badge">ÈÉ®ÂàÜ</span>
								</div>
							</div>
                        </div>
                        
                        <button class="btn btn-export-html" onclick="exportHTML()">
                            <i class="fas fa-code"></i>
                            <span>ÂåØÂá∫ HTML</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- Â∑•ÂÖ∑Âàó -->
        <div class="file-viewer">
            <div class="toolbar">
                <div class="toolbar-group">
                    <button class="btn btn-gradient-primary btn-modern" onclick="scrollToTarget()">
                        <i class="fas fa-crosshairs me-1"></i>ÁõÆÊ®ôË°å
                    </button>
                    <button class="btn btn-outline-info btn-modern" onclick="showRangeSelector()">
                        <i class="fas fa-edit me-1"></i>ÈÅ∏ÊìáÁØÑÂúç
                    </button>
					<button class="btn btn-clear-highlights btn-modern" onclick="clearAllHighlights()">
						<i class="fas fa-eraser me-1"></i>Ê∏ÖÈô§È´ò‰∫Æ
					</button>
					<button class="btn btn-outline-secondary btn-modern" onclick="toggleJumpModeFixed()" id="jump-mode-btn">
						<i class="fas fa-crosshairs me-1"></i>Ë∑≥ËΩâÊ®°Âºè
					</button>
                    
                    <!-- Âø´ÈÄüÂ∞éËà™ÊåâÈàï -->
					<div class="quick-nav-buttons" style="display: none;">
						<button class="btn-quick-nav" onclick="gotoNextBookmarkSilent()" title="‰∏ã‰∏ÄÂÄãÊõ∏Á±§ (F3)">
							<i class="fas fa-bookmark"></i>
							<i class="fas fa-arrow-right"></i>
						</button>
						<button class="btn-quick-nav warning" onclick="gotoNextJumpSilent()" title="‰∏ã‰∏ÄÂÄãË∑≥ËΩâÈªû (F2)">
							<i class="fas fa-crosshairs"></i>
							<i class="fas fa-arrow-right"></i>
						</button>
					</div>
                </div>
                
                <div class="toolbar-group">
                    <div class="search-container">
                        <input type="text" class="form-control search-input" 
                               id="search-input" placeholder="ÊêúÂ∞ãÊñáÂ≠ó (ÊîØÊè¥Ê≠£Ë¶èË°®ÈÅîÂºè) - Êåâ Ctrl+F Âø´ÈÄüÊêúÂ∞ã">
                        <div class="search-controls">
                            <button class="regex-toggle" id="regex-toggle" onclick="toggleRegex()" title="ÂàáÊèõÊ≠£Ë¶èË°®ÈÅîÂºèÊ®°Âºè">
                                <i class="fas fa-code"></i> Regex
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="findPrevious()" title="‰∏ä‰∏ÄÂÄã (Shift+Enter)">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="findNext()" title="‰∏ã‰∏ÄÂÄã (Enter)">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="search-info" id="search-info">0 / 0</div>
                        </div>
                    </div>
                </div>
                
				<div class="toolbar-group">
					<div id="jump-line-wrapper" style="width: 240px;">
						<input type="number" class="form-control" id="jump-line" 
							   placeholder="Ë∑≥ËΩâË°åËôü (Ctrl+G)" min="1" max="{{ result.total_lines }}"
							   title="Ëº∏ÂÖ•Ë°åËôüÂø´ÈÄüË∑≥ËΩâÔºåÊàñÊåâ Ctrl+G ÈñãÂïüÂ¢ûÂº∑Ë∑≥ËΩâÂ∞çË©±Ê°Ü">
						<button class="btn btn-gradient-primary" onclick="jumpToLine()" title="Ë∑≥ËΩâÂà∞ÊåáÂÆöË°åËôü">
							<i class="fas fa-arrow-right"></i>
						</button>
					</div>
				</div>
            </div>

            <!-- ÁØÑÂúçÈÅ∏ÊìáÂô® -->
            <div id="range-selector" class="range-selector" style="display: none;">
                <h6><i class="fas fa-sliders-h"></i>ÈÅ∏ÊìáÈ°ØÁ§∫ÁØÑÂúç</h6>
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">
                            <i class="fas fa-arrow-up"></i>
                            Ëµ∑ÂßãË°å
                        </label>
                        <div class="number-input-group">
                            <input type="number" class="form-control" id="range-start" 
                                   min="1" max="{{ result.total_lines }}" value="{{ result.start_line }}"
                                   placeholder="1">
                            <div class="number-input-controls">
                                <button type="button" onclick="changeNumber('range-start', 1)">
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button type="button" onclick="changeNumber('range-start', -1)">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">
                            <i class="fas fa-arrow-down"></i>
                            ÁµêÊùüË°å
                        </label>
                        <div class="number-input-group">
                            <input type="number" class="form-control" id="range-end" 
                                   min="1" max="{{ result.total_lines }}" value="{{ result.end_line }}"
                                   placeholder="{{ result.total_lines }}">
                            <div class="number-input-controls">
                                <button type="button" onclick="changeNumber('range-end', 1)">
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button type="button" onclick="changeNumber('range-end', -1)">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">
                            <i class="fas fa-expand-arrows-alt"></i>
                            ‰∏ä‰∏ãÊñáË°åÊï∏
                        </label>
                        <div class="number-input-group">
                            <input type="number" class="form-control" id="range-context" 
                                   min="0" max="500" value="200"
                                   placeholder="200"
                                   title="Ë®≠ÂÆöÂæåÂ∞á‰ª•ÁØÑÂúç‰∏≠ÂøÉÁÇ∫Âü∫Ê∫ñÔºåÂâçÂæåÂêÑÈ°ØÁ§∫ÊåáÂÆöË°åÊï∏">
                            <div class="number-input-controls">
                                <button type="button" onclick="changeNumber('range-context', 10)">
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button type="button" onclick="changeNumber('range-context', -10)">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 d-flex align-items-end gap-2">
                        <button class="btn btn-gradient-primary" onclick="applyRange()">
                            <i class="fas fa-check me-1"></i>Â•óÁî®
                        </button>
                        <button class="btn btn-outline-secondary" onclick="closeRangeSelector()">
                            <i class="fas fa-times me-1"></i>ÂèñÊ∂à
                        </button>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <label class="form-label">
                            <i class="fas fa-tachometer-alt"></i>
                            Âø´ÈÄüÈÅ∏ÊìáÁØÑÂúç
                        </label>
						<select class="form-select" onchange="quickRangeSelect(this.value)">
							<option value="">-- ÈÅ∏ÊìáÈ†êË®≠ÁØÑÂúç --</option>
							<option value="100">ÂâçÂæå 100 Ë°å</option>
							<option value="200">ÂâçÂæå 200 Ë°å</option>
							<option value="500">ÂâçÂæå 500 Ë°å</option>
							<option value="1000">ÂâçÂæå 1000 Ë°å</option>
							<option value="all">È°ØÁ§∫ÂÖ®ÈÉ®</option>
						</select>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block mt-4">
                            <i class="fas fa-info-circle me-1"></i>
                            ÊèêÁ§∫ÔºöËã•Ë®≠ÂÆö‰∏ä‰∏ãÊñáË°åÊï∏ÔºåÂ∞á‰ª•ÁØÑÂúç‰∏≠ÂøÉÁÇ∫Âü∫Ê∫ñÔºåÂâçÂæåÂêÑÈ°ØÁ§∫ÊåáÂÆöË°åÊï∏
                        </small>
                    </div>
                </div>
            </div>

            <!-- Á®ãÂºèÁ¢ºÂÖßÂÆπ -->
            <div class="line-container" id="line-container">
                <div id="loading-overlay-top" class="loading-overlay top" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">ËºâÂÖ•‰∏≠...</div>
                </div>
                <div id="loading-overlay-bottom" class="loading-overlay bottom" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">ËºâÂÖ•‰∏≠...</div>
                </div>
                {% for line in result.lines %}
                <div class="code-line {% if line.is_target %}line-target{% endif %}" 
                     id="line-{{ line.line_number }}" data-line="{{ line.line_number }}">
						<div class="line-number" 
							 ondblclick="handleLineDoubleClick({{ line.line_number }})"
							 oncontextmenu="showLineContextMenu(event, {{ line.line_number }})"
							 title="ÈõôÊìäÈ°ØÁ§∫‰∏ä‰∏ãÊñáÔºåÂè≥ÈçµÊõ¥Â§öÈÅ∏È†Ö">
							{{ line.line_number }}
						</div>
                    <div class="line-content" oncontextmenu="showContentContextMenu(event, {{ line.line_number }})">{{ line.content if line.content else ' ' }}</div>
                </div>
                {% endfor %}
            </div>

            <!-- ÁãÄÊÖãÂàó -->
            <div class="status-bar">
                <div class="d-flex align-items-center">
                    <div class="status-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span id="status-line">Á¨¨ {{ result.target_line }} Ë°å</span>
                    </div>
                    <div class="status-item hover-info">
                        <i class="fas fa-mouse-pointer"></i>
                        <span id="status-hover">ÊªëÈº†: --</span>
                    </div>
                    <div class="status-item target-info">
                        <i class="fas fa-bullseye"></i>
                        <span id="status-target">ÁõÆÊ®ô: Á¨¨ {{ result.target_line }} Ë°å</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-bookmark"></i>
                        <span id="status-bookmarks">Êõ∏Á±§: 0</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-search"></i>
                        <span id="status-search">ÊêúÂ∞ã: ÁÑ°</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-crosshairs"></i>
                        <span id="status-jumps">Ë∑≥ËΩâÈªû: 0</span>
                    </div>
                    <div class="status-item shortcut-hint">
                        <i class="fas fa-keyboard"></i>
                        <span>Ctrl+G: Ë∑≥ËΩâË°åËôü</span>
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <div class="status-item">
                        <i class="fas fa-info-circle"></i>
                        <span id="status-position">{{ result.start_line }}-{{ result.end_line }} / {{ result.total_lines }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ë∑≥ËΩâÂ∞éËà™ -->
    <div id="jump-navigation" class="jump-navigation">
        <i class="fas fa-crosshairs me-2"></i>
        Ë∑≥ËΩâÊ®°ÂºèÂ∑≤ÂïüÁî® - F2: ‰∏ã‰∏ÄÂÄã | Shift+F2: ‰∏ä‰∏ÄÂÄã
    </div>

    <!-- Âè≥ÈçµÈÅ∏ÂñÆ -->
    <div id="context-menu" class="context-menu" style="display: none;"></div>

    <!-- Toast ÂÆπÂô® -->
    <div class="toast-container" id="toast-container"></div>
    
	<!-- ËøîÂõû/Ê≠∑Âè≤ ÂÆπÂô® -->
	<div class="nav-hint" id="nav-hint"></div>

	<!-- Â∞éËà™ÂãïÁï´ÊïàÊûúÔºö -->
	<div class="navigating" id="navigating">
		<div class="navigating-content">
			<div class="navigating-spinner"></div>
			<div class="navigating-text">Ê≠£Âú®Â∞éËà™...</div>
		</div>
	</div>
	
    <!-- ÊêúÂ∞ãÁµêÊûúÊµÆÂãïÊåâÈàï -->
	<button class="search-results-fab" onclick="toggleSearchResultsPanel()" style="display: none !important;">
		<i class="fas fa-list"></i>
		<span class="badge">0</span>
	</button>
    
    <!-- Ê®ôË®òÁÆ°ÁêÜÊµÆÂãïÊåâÈàï -->
    <button class="marks-fab" onclick="toggleMarksPanel()">
        <i class="fas fa-map-marker-alt"></i>
        <span class="badge">0</span>
    </button>
    
    <!-- ÊêúÂ∞ãÁµêÊûúÈù¢Êùø -->
    <div class="search-results-panel">
        <div class="search-results-header">
            <h5>ÊêúÂ∞ãÁµêÊûú</h5>
            <button class="search-results-close" onclick="hideSearchResultsPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-results-body"></div>
        <div class="search-results-footer">
            <button class="btn-scroll-top" onclick="scrollToSearchTop()">
                <i class="fas fa-arrow-up me-2"></i>ÂõûÂà∞È†ÇÈÉ®
            </button>
        </div>
    </div>
    
	<!-- Ê®ôË®òÁÆ°ÁêÜÈù¢Êùø -->
	<div class="marks-panel">
		<div class="marks-panel-header">
			<h5>Ê®ôË®òÁÆ°ÁêÜ</h5>
			<button class="search-results-close" onclick="hideMarksPanel()">
				<i class="fas fa-times"></i>
			</button>
		</div>
		<div class="marks-panel-tabs">
			<div class="marks-panel-tab active" data-type="jumps" onclick="changeMarksTab('jumps')">
				<i class="fas fa-crosshairs me-1"></i>Ë∑≥ËΩâÈªû
			</div>
			<div class="marks-panel-tab" data-type="bookmarks" onclick="changeMarksTab('bookmarks')">
				<i class="fas fa-bookmark me-1"></i>Êõ∏Á±§
			</div>
		</div>
		<div class="marks-panel-body"></div>
		<div class="marks-panel-footer">
			<button class="btn btn-outline-danger btn-sm" onclick="clearAllJumpPointsEnhanced()">
				<i class="fas fa-trash me-1"></i>Ê∏ÖÈô§ÊâÄÊúâË∑≥ËΩâÈªû
			</button>
			<button class="btn btn-outline-danger btn-sm" onclick="clearAllBookmarksEnhanced()" style="display: none;">
				<i class="fas fa-trash me-1"></i>Ê∏ÖÈô§ÊâÄÊúâÊõ∏Á±§
			</button>
		</div>
	</div>
	
	<!-- ÊêúÂ∞ãÁµêÊûúÊµÆÂãïÊåâÈàï -->
	<button class="search-results-fab" onclick="toggleSearchResultsPanel()" style="display: none;">
		<i class="fas fa-list"></i>
		<span class="badge">0</span>
	</button>

	<!-- Ê®ôË®òÁÆ°ÁêÜÊµÆÂãïÊåâÈàï -->
	<button class="marks-fab" onclick="toggleMarksPanel()" style="display: none;">
		<i class="fas fa-map-marker-alt"></i>
		<span class="badge">0</span>
	</button>

	<!-- Ê®ôË®òÁÆ°ÁêÜÈù¢Êùø -->
	<div class="marks-panel">
		<div class="marks-panel-header">
			<h5>Ê®ôË®òÁÆ°ÁêÜ</h5>
			<button class="search-results-close" onclick="hideMarksPanel()">
				<i class="fas fa-times"></i>
			</button>
		</div>
		<div class="marks-panel-tabs">
			<div class="marks-panel-tab active" data-type="jumps" onclick="changeMarksTab('jumps')">
				<i class="fas fa-crosshairs me-1"></i>Ë∑≥ËΩâÈªû
			</div>
			<div class="marks-panel-tab" data-type="bookmarks" onclick="changeMarksTab('bookmarks')">
				<i class="fas fa-bookmark me-1"></i>Êõ∏Á±§
			</div>
		</div>
		<div class="marks-panel-body"></div>
		<div class="marks-panel-footer">
			<button class="btn btn-outline-danger btn-sm" onclick="clearAllJumpPoints()">
				<i class="fas fa-trash me-1"></i>Ê∏ÖÈô§ÊâÄÊúâË∑≥ËΩâÈªû
			</button>
			<button class="btn btn-outline-danger btn-sm" onclick="clearAllBookmarks()" style="display: none;">
				<i class="fas fa-trash me-1"></i>Ê∏ÖÈô§ÊâÄÊúâÊõ∏Á±§
			</button>
		</div>
	</div>

    <!-- Ë©ïË´ñÂäüËÉΩÊåâÈàï -->
    <div class="comment-fab-wrapper">
        <button class="comment-fab" onclick="openCommentDialog()">
            <span>+</span>
        </button>
        <div class="comment-fab-tooltip">Êñ∞Â¢ûË©ïË´ñ</div>
    </div>

    <!-- ÂõûÂà∞È†ÇÈÉ®ÊåâÈàï -->
    <button class="back-to-top" id="back-to-top" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Ë©ïË´ñÂ∞çË©±Ê°Ü -->
    <div id="comment-dialog" class="comment-dialog">
        <div class="comment-dialog-overlay"></div>
        <div class="comment-dialog-content">
            <div class="comment-dialog-header">
                <h5><i class="fas fa-comment-plus" style="margin-right: 10px;"></i>Êñ∞Â¢ûË©ïË´ñ</h5>
                <button class="comment-dialog-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="comment-dialog-body">
                <!-- ‰∏ªÈ°åÈÅ∏ÊìáÂô® -->
                <div class="comment-topic-selector">
                    <label class="form-label">
                        <i class="fas fa-folder"></i> Ë®éË´ñ‰∏ªÈ°åÔºàÈÅ∏Â°´Ôºâ
                    </label>
                    <input type="text" class="topic-input" id="comment-topic" 
                        placeholder="Ëº∏ÂÖ•ÊàñÈÅ∏Êìá‰∏ªÈ°å..." list="topic-list">
                    <datalist id="topic-list">
                        <option value="‰∏ÄËà¨Ë®éË´ñ">
                        <option value="ÈåØË™§Â†±Âëä">
                        <option value="ÂäüËÉΩÂª∫Ë≠∞">
                        <option value="Á®ãÂºèÁ¢ºÊ™¢Ë®é">
                    </datalist>
                </div>
                
                <!-- ÂØåÊñáÊú¨Á∑®ËºØÂô®Â∑•ÂÖ∑Âàó -->
                <div class="comment-toolbar">
                    <button class="comment-toolbar-btn" data-command="formatBlock" data-value="h1" title="Ê®ôÈ°å 1">
                        <strong>H1</strong>
                    </button>
                    <button class="comment-toolbar-btn" data-command="formatBlock" data-value="h2" title="Ê®ôÈ°å 2">
                        <strong>H2</strong>
                    </button>
                    <button class="comment-toolbar-btn" data-command="formatBlock" data-value="h3" title="Ê®ôÈ°å 3">
                        <strong>H3</strong>
                    </button>
                    <div class="comment-toolbar-separator"></div>
                    <button class="comment-toolbar-btn" data-command="bold" title="Á≤óÈ´î">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="italic" title="ÊñúÈ´î">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="underline" title="Â∫ïÁ∑ö">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="strikeThrough" title="Âà™Èô§Á∑ö">
                        <i class="fas fa-strikethrough"></i>
                    </button>
                    <div class="comment-toolbar-separator"></div>
                    <!-- È°èËâ≤ÈÅ∏ÊìáÂô® -->
                    <div class="color-picker-wrapper">
                        <button class="comment-toolbar-btn" data-command="foreColor" title="ÊñáÂ≠óÈ°èËâ≤">
                            <i class="fas fa-font"></i>
                            <span class="color-indicator"></span>
                        </button>
                        <div class="color-palette">
                            <div class="color-palette-header">ÊñáÂ≠óÈ°èËâ≤</div>
                            <div class="color-grid">
                                <div class="color-option" style="background: #000000" onclick="applyColor('#000000', 'foreColor')"></div>
                                <div class="color-option" style="background: #545454" onclick="applyColor('#545454', 'foreColor')"></div>
                                <div class="color-option" style="background: #737373" onclick="applyColor('#737373', 'foreColor')"></div>
                                <div class="color-option" style="background: #a6a6a6" onclick="applyColor('#a6a6a6', 'foreColor')"></div>
                                <div class="color-option" style="background: #d9d9d9" onclick="applyColor('#d9d9d9', 'foreColor')"></div>
                                <div class="color-option" style="background: #ffffff" onclick="applyColor('#ffffff', 'foreColor')"></div>
                                <div class="color-option" style="background: #ff0000" onclick="applyColor('#ff0000', 'foreColor')"></div>
                                <div class="color-option" style="background: #ff9900" onclick="applyColor('#ff9900', 'foreColor')"></div>
                                <div class="color-option" style="background: #ffff00" onclick="applyColor('#ffff00', 'foreColor')"></div>
                                <div class="color-option" style="background: #00ff00" onclick="applyColor('#00ff00', 'foreColor')"></div>
                                <div class="color-option" style="background: #00ffff" onclick="applyColor('#00ffff', 'foreColor')"></div>
                                <div class="color-option" style="background: #0000ff" onclick="applyColor('#0000ff', 'foreColor')"></div>
                                <div class="color-option" style="background: #9900ff" onclick="applyColor('#9900ff', 'foreColor')"></div>
                                <div class="color-option" style="background: #ff00ff" onclick="applyColor('#ff00ff', 'foreColor')"></div>
                            </div>
                        </div>
                    </div>
                    <div class="color-picker-wrapper">
                        <button class="comment-toolbar-btn" data-command="backColor" title="ËÉåÊôØÈ°èËâ≤">
                            <i class="fas fa-marker"></i>
                            <span class="color-indicator"></span>
                        </button>
                        <div class="color-palette">
                            <div class="color-palette-header">ËÉåÊôØÈ°èËâ≤</div>
                            <div class="color-grid">
                                <div class="color-option" style="background: transparent" onclick="applyColor('transparent', 'backColor')"><i class="fas fa-ban"></i></div>
                                <div class="color-option" style="background: #fce4ec" onclick="applyColor('#fce4ec', 'backColor')"></div>
                                <div class="color-option" style="background: #fff3e0" onclick="applyColor('#fff3e0', 'backColor')"></div>
                                <div class="color-option" style="background: #fff9c4" onclick="applyColor('#fff9c4', 'backColor')"></div>
                                <div class="color-option" style="background: #f1f8e9" onclick="applyColor('#f1f8e9', 'backColor')"></div>
                                <div class="color-option" style="background: #e0f2f1" onclick="applyColor('#e0f2f1', 'backColor')"></div>
                                <div class="color-option" style="background: #e3f2fd" onclick="applyColor('#e3f2fd', 'backColor')"></div>
                                <div class="color-option" style="background: #f3e5f5" onclick="applyColor('#f3e5f5', 'backColor')"></div>
                                <div class="color-option" style="background: #ffd54f" onclick="applyColor('#ffd54f', 'backColor')"></div>
                                <div class="color-option" style="background: #aed581" onclick="applyColor('#aed581', 'backColor')"></div>
                                <div class="color-option" style="background: #80deea" onclick="applyColor('#80deea', 'backColor')"></div>
                                <div class="color-option" style="background: #90caf9" onclick="applyColor('#90caf9', 'backColor')"></div>
                                <div class="color-option" style="background: #ce93d8" onclick="applyColor('#ce93d8', 'backColor')"></div>
                                <div class="color-option" style="background: #f8bbd0" onclick="applyColor('#f8bbd0', 'backColor')"></div>
                            </div>
                        </div>
                    </div>
                    <div class="comment-toolbar-separator"></div>
                    <button class="comment-toolbar-btn" data-command="insertUnorderedList" title="È†ÖÁõÆÁ¨¶Ëôü">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="insertOrderedList" title="Á∑®Ëôü">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="formatBlock" data-value="blockquote" title="ÂºïÁî®">
                        <i class="fas fa-quote-left"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="insertCode" title="Á®ãÂºèÁ¢º">
                        <i class="fas fa-code"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="insertTable" title="ÊèíÂÖ•Ë°®Ê†º">
                        <i class="fas fa-table"></i>
                    </button>
                    <div class="comment-toolbar-separator"></div>
                    <button class="comment-toolbar-btn" data-command="createLink" title="ÊèíÂÖ•ÈÄ£Áµê">
                        <i class="fas fa-link"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="insertImage" title="ÊèíÂÖ•ÂúñÁâá">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="undo" title="Âæ©Âéü">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button class="comment-toolbar-btn" data-command="redo" title="ÈáçÂÅö">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
                
                <!-- Á∑®ËºØÂô® -->
                <div id="comment-editor" class="comment-editor" contenteditable="true" 
                    placeholder="Âú®Ê≠§Ëº∏ÂÖ•Ë©ïË´ñÂÖßÂÆπ...ÊîØÊè¥ÊãñÊîæÊàñË≤º‰∏äÂúñÁâá"></div>
                
                <!-- ÈôÑ‰ª∂È°ØÁ§∫ÂçÄ -->
                <div id="comment-attachments" class="comment-attachments"></div>
            </div>
            <div class="comment-dialog-footer">
                <div class="comment-info">
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i>
                        ÊîØÊè¥ Ctrl+V Ë≤º‰∏äÂúñÁâáÔºåÊàñÊãñÊîæÊ™îÊ°à
                    </small>
                </div>
                <div class="comment-actions">
                    <button class="btn btn-outline-secondary btn-modern" id="cancel-comment" onclick="closeCommentDialog()">
                        <i class="fas fa-times"></i> ÂèñÊ∂à
                    </button>
                    <button class="btn btn-gradient-primary btn-modern" id="submit-comment" onclick="submitComment()">
                        <i class="fas fa-paper-plane"></i> ÈÄÅÂá∫
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Á®ãÂºèÁ¢ºÂ∞çË©±Ê°Ü -->
    <div id="code-dialog" class="code-dialog">
        <div class="code-dialog-overlay" onclick="closeCodeDialog()"></div>
        <div class="code-dialog-content">
            <div class="code-dialog-header">
                <h5><i class="fas fa-code" style="margin-right: 10px;"></i>ÊèíÂÖ•Á®ãÂºèÁ¢º</h5>
                <button class="comment-dialog-close" onclick="closeCodeDialog()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="code-dialog-body">
                <div class="code-input-section">
                    <div class="language-selector">
                        <label class="form-label">ÈÅ∏ÊìáÁ®ãÂºèË™ûË®Ä</label>
                        <select id="code-language">
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="c">C</option>
                            <option value="cpp">C++</option>
                            <option value="xml">XML</option>
                            <option value="json">JSON</option>
                            <option value="html">HTML</option>
                            <option value="css">CSS</option>
                            <option value="sql">SQL</option>
                            <option value="bash">Bash</option>
                            <option value="ini">INI</option>
                            <option value="diff">Diff</option>
                            <option value="kotlin">Android/Kotlin</option>
                        </select>
                    </div>
                    <div class="code-textarea-wrapper">
                        <textarea id="code-textarea" class="code-textarea" 
                                placeholder="Âú®Ê≠§Ë≤º‰∏äÊàñËº∏ÂÖ•Á®ãÂºèÁ¢º...ÊàñÊãñÊõ≥Ê™îÊ°àÂà∞ÈÄôË£°"></textarea>
                    </div>
                </div>
                <!-- Êñ∞Â¢ûÔºöÂèØÊãñÊõ≥ÂàÜÈöîÁ∑ö -->
                <div class="code-resizer" id="code-resizer">
                    <div class="resizer-line"></div>
                </div>
                <div class="code-preview-section">
                    <label class="preview-label">È†êË¶Ω</label>
                    <div class="code-preview">
                        <pre><code>// Á®ãÂºèÁ¢ºÈ†êË¶ΩÂ∞áÈ°ØÁ§∫Âú®ÈÄôË£°</code></pre>
                    </div>
                </div>
            </div>
            <div class="code-dialog-footer">
                <button class="btn btn-outline-secondary btn-modern" onclick="closeCodeDialog()">
                    <i class="fas fa-times"></i> ÂèñÊ∂à
                </button>
                <button class="btn btn-gradient-primary btn-modern" onclick="insertCodeBlock()">
                    <i class="fas fa-check"></i> ÊèíÂÖ•
                </button>
            </div>
        </div>
    </div>

    <!-- ÁâàÊ¨äËÅ≤Êòé -->
    <div class="copyright-footer">
        <i class="fas fa-heart"></i>
        ¬© 2025 Vince. All rights reserved.
        <i class="fas fa-code"></i>
        Enhanced File Viewer v8
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Ëá™ÂÆöÁæ© JavaScript -->
    <script src="/static/js/file_viewer.js"></script>
	<script src="/static/js/file_viewer_marks.js"></script>
	<script src="/static/js/file_viewer_fixes.js"></script>
	<script src="/static/js/file_viewer_enhanced.js"></script>
	<script src="/static/js/file_viewer_final.js"></script>
	<script src="/static/js/file_viewer_navigation_fix.js"></script>
	<script src="/static/js/file_viewer_export_fix.js"></script>
	<script src="/static/js/file_viewer_export_full_page.js"></script>
	<script src="/static/js/file_viewer_goto_line.js"></script>
    <script src="/static/js/file_viewer_comments.js"></script>
	
	<!-- Ë™øË©¶Ê®°ÂºèÊ™¢Êü• -->
	<script>
		// Ê™¢Êü•ÊòØÂê¶ÂïüÁî®Ë™øË©¶Ê®°Âºè
		if (window.location.search.includes('debug=true') || 
			localStorage.getItem('gotoDebugMode') === 'true') {
			console.log('üîß Ë™øË©¶Ê®°ÂºèÂ∑≤ÂïüÁî®');
			
			// Ê∑ªÂä†Ë™øË©¶‰ø°ÊÅØÈ°ØÁ§∫
			setTimeout(() => {
				if (window.GotoDebugHelper) {
					const debugDiv = document.createElement('div');
					debugDiv.className = 'goto-debug';
					debugDiv.innerHTML = `
						<div><strong>Ctrl+G Ë™øË©¶Ê®°Âºè</strong></div>
						<div>Êåâ F12 ÈñãÂïüÊéßÂà∂Âè∞Êü•ÁúãË©≥Á¥∞‰ø°ÊÅØ</div>
						<div>Âü∑Ë°å GotoDebugHelper.runDiagnostics() ÈÄ≤Ë°åË®∫Êñ∑</div>
					`;
					document.body.appendChild(debugDiv);
					
					// 5ÁßíÂæåËá™ÂãïÈö±Ëóè
					setTimeout(() => {
						debugDiv.style.opacity = '0';
						setTimeout(() => debugDiv.remove(), 1000);
					}, 5000);
				}
			}, 1000);
		}
	</script>
</body>
</html>